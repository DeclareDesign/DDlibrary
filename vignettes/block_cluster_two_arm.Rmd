---
title: "Block-Cluster-Two-Arm Design"
output: rmarkdown::html_vignette
bibliography: bib.bib
nocite: |
  @Gerber2012
designer: "block_cluster_two_arm_designer.Rd"
vignette: >
  %\VignetteIndexEntry{Block-Cluster-Two-Arm Design}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(DesignLibrary)
library(knitr)
```




Cluster randomization is a research design in which subjects are group into clusters and assigned as a group to either treatment or control. When the clusters are of equal size the difference-in-difference estimator yields  unbiased but non-precise estimates, especially when individuals are very similar within clusters and share characteristics that can potentially influence outcomes. Despite its drawbacks, cluster designs are sometimes unavoidable. For instance, imagine that we want to evaluate the effects of radio ads on donations. It's, of course, impossible to target a radio ad to a single individual, and the treatment must be instead assigned at a higher level; for instance at the city level.

In block random assignment the population is sorted according to some pre-treatment covariates and treatment is randomized within each block. Two main objectives can be achieved with block randomization; first, sampling variability can be reduced when individuals that belong to a specific block have similar potential outcomes. The second reason arises when the number of individuals within a block is specified in advance. For instance, policymakers migh dictate how many women should join a program.

In block-cluster-two-arm designs, a whole cluster belongs to one block. Within each block complete random assigment is performed and as a result some clusters are assigned to treatment and others to control.

Looking back to our radio ad example, imagine that policymakers dictate that four cities within each region should be treated and four assigned to control. This means that in the control and treatment groups there will be individuals from all regions, but only from a few cities within each region. We declare this design below.

### Design Declaration

- **M**odel:  We specify a population partitioned into $N\_blocks = 2$  regions. Each region has $N\_clusters\_in\_block  = 4$ cities and within each city there are $N\_in\_cluster = 5$  individuals.  Our potential outcomes are the amount donated per subject under the treatment ($Y_i(Z=1)$) and under control ($Y_i(Z=0)$). The variance of an individual's outcomes have three components:  the block's variance, the cluster's variance and the subject's variance. The treatment effect is computed as $Y_i(Z = 1) - Y_i(Z = 0)$
  
- **I**nquiry: We are interested in the average treatment effect between control and treatment groups. Formally, $E[Y_i(Z = 1) - Y_i(Z = 0)]$

- **D**ata strategy:  The units of randomization are cities (clusters). Cities are blocked by region so that we ensure that $4$ cities from each region are included in control and $4$ in treatment. All individuals that belong to a same city are either treated or assigned to control.

- **A**nswer strategy: We estimate the average treatment effect using the difference-in-means estimator.



In code:


```{r, code = get_design_code(block_cluster_two_arm_designer(N_blocks = 4, N_clusters_in_block = 4, N_i_in_cluster = 5 )), eval=TRUE}

```

### Diagnosis


```{r,eval = TRUE}
diagnosis <- diagnose_design( block_cluster_two_arm_designer(N_blocks = 2,
                                                     N_clusters_in_block = 4, 
                                                     N_i_in_cluster = 5
                                                    ))
```


```{r,eval = TRUE, echo = FALSE}
kable(reshape_diagnosis(diagnosis)[, -c(1:2, 4:6, 13,14)], digits = 2)
```

The main point to make here is that the difference-in-means estimator produces unbiased but noisy estimates. In fact, due to the size of its standard error and the sample size our power is low and thus we would often fail to reject the hyphotesis of non-significance. This become less of a problem as sample size increases.

### Further reading 
